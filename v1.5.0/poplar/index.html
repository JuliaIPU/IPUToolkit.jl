<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Poplar SDK · IPUToolkit.jl</title><meta name="title" content="Poplar SDK · IPUToolkit.jl"/><meta property="og:title" content="Poplar SDK · IPUToolkit.jl"/><meta property="twitter:title" content="Poplar SDK · IPUToolkit.jl"/><meta name="description" content="Documentation for IPUToolkit.jl."/><meta property="og:description" content="Documentation for IPUToolkit.jl."/><meta property="twitter:description" content="Documentation for IPUToolkit.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">IPUToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">IPUToolkit</a></li><li class="is-active"><a class="tocitem" href>Poplar SDK</a><ul class="internal"><li><a class="tocitem" href="#Convenient-methods"><span>Convenient methods</span></a></li></ul></li><li><a class="tocitem" href="../compiler/">Writing codelets</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Poplar SDK</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Poplar SDK</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIPU/IPUToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/main/docs/src/poplar.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Interfacing-the-Poplar-SDK"><a class="docs-heading-anchor" href="#Interfacing-the-Poplar-SDK">Interfacing the Poplar SDK</a><a id="Interfacing-the-Poplar-SDK-1"></a><a class="docs-heading-anchor-permalink" href="#Interfacing-the-Poplar-SDK" title="Permalink"></a></h1><p>A quick example of use of the Poplar SDK functionalities, available in the <code>IPUToolkit.Poplar</code> submodule:</p><pre><code class="language-julia hljs">julia&gt; using IPUToolkit.Poplar

julia&gt; dm = Poplar.DeviceManager();

julia&gt; Int(Poplar.DeviceManagerGetNumDevices(dm))
129

julia&gt; device = Poplar.get_ipu_device();
[ Info: Trying to attach to device 0...
[ Info: Successfully attached to device 0

julia&gt; Int(Poplar.DeviceGetId(device))
0

julia&gt; Poplar.detach_devices()</code></pre><p>A couple of basic examples of programs running on the IPU written using the interface to the Poplar SDK are available in the files <a href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/main/examples/tutorial1.jl"><code>examples/tutorial1.jl</code></a> and <a href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/main/examples/tutorial2.jl"><code>examples/tutorial2.jl</code></a>.</p><p>We automatically generate the bindings of the Poplar SDK using <a href="https://github.com/JuliaInterop/Clang.jl"><code>Clang.jl</code></a> and <a href="https://github.com/JuliaInterop/CxxWrap.jl"><code>CxxWrap.jl</code></a>. There is not automatic documentation at the moment, but functions can be accessed from the <code>Poplar</code> submodule. Also, the <code>IPUToolkit.Poplar</code> submodule wraps a subset of the functionalities available in the Poplar SDK, do not expect to be able to use all functionalities. Remember that Julia does not use class-based object-oriented programming, class instances will usually be first arguments of the methods you want to use.</p><p>Function naming convention and signature is usually as follows:</p><ul><li>class name in <a href="https://en.wikipedia.org/wiki/Camel_case">CamelCase</a>, followed by method name also in CamelCase.  Note that first letter of method name is always uppercase in this naming convention, even if it is lowercase in the Poplar SDK.  For example, the method <code>getNumDevices</code> of the <code>DeviceManager</code> class can be accessed in the <code>Poplar</code> submodule with <code>Poplar.DeviceManagerGetNumDevices</code>;</li><li>the first argument of the function is the class instance.  For example, to use the Julia function <code>Poplar.DeviceManagerGetNumDevices</code>, you need to pass as first argument an instance of <code>DeviceManager</code>;</li><li>the following arguments are the same as in the method you want to use in the SDK.  For example, the method <code>getNumDevices</code> of the <code>DeviceManager</code> class doesn&#39;t take any argument, so the Julia function <code>Poplar.DeviceManagerGetNumDevices</code> will take an instance of <code>DeviceManager</code> as <em>only</em> argument.</li></ul><h2 id="Convenient-methods"><a class="docs-heading-anchor" href="#Convenient-methods">Convenient methods</a><a id="Convenient-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Convenient-methods" title="Permalink"></a></h2><p>In addition to this, for some functions (e.g. <code>EngineWriteTensor</code>, <code>EngineConnectStream</code>, <code>EngineReadTensor</code>) we provide more user-friendly methods where the last argument can be a Julia&#39;s <code>Array</code>, without having to pass additional arguments for pointers or array size. Furthermore, the custom functions <a href="#IPUToolkit.Poplar.get_ipu_device"><code>Poplar.get_ipu_device</code></a> and <a href="#IPUToolkit.Poplar.get_ipu_devices"><code>Poplar.get_ipu_devices</code></a> can be used to access one more IPU devices, as shown in the example above.</p><p>Another function for which we provide a convenient method is <code>Poplar.GraphAddConstant</code>:</p><pre><code class="language-julia hljs">Poplar.GraphAddConstant(graph, host_array)</code></pre><p>adds the <code>host_array</code> (a plain standard Julia <code>Array</code> living on the host) to <code>graph</code>, automatically inferring from <code>host_array</code> the type and the shape of the tensor in the graph. This works also with <code>host_array::Array{Float16}</code>.</p><p>You can slice a tensor with the usual Julia notation <code>tensor[index1:index2]</code>, this corresponds to a call to <a href="https://docs.graphcore.ai/projects/poplar-api/en/latest/poplar/graph/Tensor.html#_CPPv4NK6poplar6Tensor5sliceENSt6size_tENSt6size_tE"><code>Tensor.slice(index1, index2+1)</code></a>.</p><p><a href="#Base.similar-Tuple{IPUToolkit.Poplar.Graph, Union{IPUToolkit.Poplar.TensorAllocated, Array}}"><code>similar</code></a> can be used to add to <code>graph</code> a tensor with the same shape and optionally element type as <code>tensor</code>, while <a href="#Base.copyto!-Union{Tuple{T}, Tuple{IPUToolkit.Poplar.GraphAllocated, IPUToolkit.Poplar.TensorAllocated, Array{T}}} where T"><code>copyto!</code></a> can be used to copy elements of a CPU host array into an IPU tensor.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.copyto!-Union{Tuple{T}, Tuple{IPUToolkit.Poplar.GraphAllocated, IPUToolkit.Poplar.TensorAllocated, Array{T}}} where T" href="#Base.copyto!-Union{Tuple{T}, Tuple{IPUToolkit.Poplar.GraphAllocated, IPUToolkit.Poplar.TensorAllocated, Array{T}}} where T"><code>Base.copyto!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">copyto!(
    graph::Poplar.Graph,
    dest::Poplar.TensorAllocated,
    src::Array
) -&gt; Poplar.TensorAllocated</code></pre><p>In the given <code>graph</code> copies the elements of the CPU host array <code>src</code> to the IPU tensor <code>dest</code>, using <a href="https://docs.graphcore.ai/projects/poplar-api/en/latest/poplar/graph/Graph.html#_CPPv4I0EN6poplar5Graph15setInitialValueEvRK6Tensor1TPNSt9enable_ifIFN10TypeTraits12isSimpleTypeI1TEEvEE4typeE"><code>Graph::setInitialValue</code></a> under the hood. The elements of <code>src</code> must have a type corresponding to the type of <code>dest</code> (e.g. <code>Float16</code> for a <code>half</code> IPU tensor, or <code>Float32</code> for a <code>float</code> IPU tensor). This function returns <code>dest</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/925638312e9b081ec4da07d03b5192fac9cecd7f/src/poplar.jl#L178-L188">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.similar-Tuple{IPUToolkit.Poplar.Graph, Union{IPUToolkit.Poplar.TensorAllocated, Array}}" href="#Base.similar-Tuple{IPUToolkit.Poplar.Graph, Union{IPUToolkit.Poplar.TensorAllocated, Array}}"><code>Base.similar</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">similar(
    graph::Poplar.Graph,
    tensor::Union{Poplar.TensorAllocated,Array},
    [type::DataType],
    [debug::String]
) -&gt; Poplar.TensorAllocated</code></pre><p>Adds to <code>graph</code> a variable tensor with the same shape as <code>tensor</code>, which can be either an IPU tensor or a plain CPU host <code>Array</code>, using <a href="https://docs.graphcore.ai/projects/poplar-api/en/latest/poplar/graph/Graph.html#_CPPv4N6poplar5Graph11addVariableERK4Type8ArrayRefINSt6size_tEERK12DebugContext"><code>Graph::addVariable</code></a> under the hood. If a <code>type</code> (this is a Julia type, like <code>Float32</code> or <code>Int32</code>) argument is not passed, the same element type as <code>tensor</code> will be automatically used. An optional <code>debug</code> context can also be passed, as a <code>String</code>. This function returns a pointer to the tensor added to the graph.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/925638312e9b081ec4da07d03b5192fac9cecd7f/src/poplar.jl#L156-L168">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="IPUToolkit.Poplar.detach_devices-Tuple{}" href="#IPUToolkit.Poplar.detach_devices-Tuple{}"><code>IPUToolkit.Poplar.detach_devices</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">Poplar.detach_devices() -&gt; Nothing</code></pre><p>Detach all devices previously attached in the current Julia session with <a href="#IPUToolkit.Poplar.get_ipu_devices"><code>Poplar.get_ipu_devices</code></a> or <a href="#IPUToolkit.Poplar.get_ipu_device"><code>Poplar.get_ipu_device</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/925638312e9b081ec4da07d03b5192fac9cecd7f/src/poplar.jl#L286-L290">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="IPUToolkit.Poplar.get_ipu_device" href="#IPUToolkit.Poplar.get_ipu_device"><code>IPUToolkit.Poplar.get_ipu_device</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Poplar.get_ipu_device(hint::Union{AbstractVector{&lt;:Integer},Integer}=0)</code></pre><p>Similar to <a href="#IPUToolkit.Poplar.get_ipu_devices"><code>Poplar.get_ipu_devices</code></a>, but request exactly one IPU device.  If it can attach to a device, return that pointer only (not in a vector, like <code>get_ipu_devices</code>), otherwise return <code>nothing</code>.  You can release the device with <code>Poplar.DeviceDetach(device)</code>. To release all devices previously attached with <code>Poplar.get_ipu_device</code> or <a href="#IPUToolkit.Poplar.get_ipu_devices"><code>Poplar.get_ipu_devices</code></a> use <a href="#IPUToolkit.Poplar.detach_devices-Tuple{}"><code>Poplar.detach_devices</code></a>.</p><p>The optional argument <code>hint</code> suggests to which device IDs to try and attach.  It can have different types:</p><ul><li>if of type <code>Integer</code>, try to attach to one device, starting from the one with index <code>hint</code>. The default is <code>hint=0</code>;</li><li>if of type <code>AbstractVector</code>, try to attach to a device from that list of IDs.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/925638312e9b081ec4da07d03b5192fac9cecd7f/src/poplar.jl#L263-L277">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="IPUToolkit.Poplar.get_ipu_devices" href="#IPUToolkit.Poplar.get_ipu_devices"><code>IPUToolkit.Poplar.get_ipu_devices</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">Poplar.get_ipu_devices(n::Int, hint::Union{AbstractVector{&lt;:Integer},Integer}=0)</code></pre><p>Try to attach to <code>n</code> IPU devices, returns a vector of the pointers to the devices successfully attached to.  You can release them with <code>Poplar.DeviceDetach</code> (note that this function takes a single pointer as input, so you have to use broadcasting <code>Poplar.DeviceDetach.(devices)</code> to release a vector of pointers).</p><p>The second optional argument <code>hint</code> suggests to which device IDs to try and attach.  It can have different types:</p><ul><li>if of type <code>Integer</code>, try to attach to <code>n</code> devices, starting from the one with index <code>hint</code>.  The default is <code>hint=0</code>;</li><li>if of type <code>AbstractVector</code>, try to attach to <code>n</code> devices from that list of IDs.</li></ul><p>See <a href="#IPUToolkit.Poplar.get_ipu_device"><code>Poplar.get_ipu_device</code></a> for requesting exactly one IPU device. To release all devices previously attached with <code>Poplar.get_ipu_devices</code> or <a href="#IPUToolkit.Poplar.get_ipu_device"><code>Poplar.get_ipu_device</code></a> use <a href="#IPUToolkit.Poplar.detach_devices-Tuple{}"><code>Poplar.detach_devices</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/925638312e9b081ec4da07d03b5192fac9cecd7f/src/poplar.jl#L209-L227">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="IPUToolkit.Poplar.@graph-Tuple{Any, Expr}" href="#IPUToolkit.Poplar.@graph-Tuple{Any, Expr}"><code>IPUToolkit.Poplar.@graph</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia hljs">@graph [graph] expr</code></pre><p>This is a convenient macro to automatically inject <code>graph</code> as first argument of all function calls in the expression passed as last argument to the macro.</p><p>The <code>graph</code> argument should be the graph object you want to pass as first argument to the function calls. If it is a local variable called exactly <code>graph</code>, this argument can be omitted and this name will be used automatically.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This macro is not very sophisticated and will fail with complex expressions involving, for example, control flows like <code>if</code> or <code>for</code>. See the examples below.</p></div></div><p><strong>Examples</strong></p><pre><code class="language-julia hljs">julia&gt; @macroexpand @graph begin
           c1 = Poplar.GraphAddConstant(Float32[1.0, 1.5, 2.0, 2.5])
           v1 = similar(c1, &quot;v1&quot;)
           copyto!(v1, Float32[4.0, 3.0, 2.0, 1.0])

           Poplar.GraphSetTileMapping(c1, 0)
           Poplar.GraphSetTileMapping(v1, 0)
       end
quote
    c1 = Poplar.GraphAddConstant(graph, Float32[1.0, 1.5, 2.0, 2.5])
    v1 = similar(graph, c1, &quot;v1&quot;)
    copyto!(graph, v1, Float32[4.0, 3.0, 2.0, 1.0])
    Poplar.GraphSetTileMapping(graph, c1, 0)
    Poplar.GraphSetTileMapping(graph, v1, 0)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaIPU/IPUToolkit.jl/blob/925638312e9b081ec4da07d03b5192fac9cecd7f/src/poplar.jl#L16-L48">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« IPUToolkit</a><a class="docs-footer-nextpage" href="../compiler/">Writing codelets »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Tuesday 26 March 2024 21:13">Tuesday 26 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
